# 软件模型



## 设备

* 设备：Devices

  * 可编程设备：PLC 虚节点

  * 参数型设备：不能分配编程对象，而是在该设备的编辑对话框中设置参数。

    注意：如果一个设备允许的话，是可以在两种类型的设备中自由切换，不需要删除后添加



* 包管理器

  ​	所有的“设备”都必须事先在“包管理器”中进行安装，包管理器在“工具”菜单中可以选择，用户可以对其进行添加包和删除包。

  ​	包中包含了，代码生成器，内存管理，PLC功能，IO模块配置，库文件等相关信息。



* 设备库

  ​	设备库是设备的数据库，安装后所有数据都被导入至用户的本地系统中，供Codesys开发使用。

  ​	设备库可用于添加所有的硬件设备，通过在该选项中导入相应文件后，使对应的数据在本地系统内生成，方便工程中调用。

  ​	可以添加的设备包含，PLC，SoftMotion运动控制设备，现场总线和IO设备。其中现场总线的可添加文件一般是设备供应商提供的相应设备描述文件，比如EtherCat的XML文件，CANopen的EDS和DCF文件。



* 设备编辑器

  ​	设备编辑器是用来配置设备的对话框，可以通过“编辑对象”命令打开。





## 应用

* 应用可以简单对应为winform中的一个项目。



* 任务

  ​	一个程序可以用不同的编程语言来编写，典型的程序由许多互连的功能块组成，各功能块之间可以相互的交换数据。

  ​	任务管理器可以控制工程内的子程序的执行处理，主要起到一个调度的作用，其中可以设定任务的调度优先级。

  ​	在配置任务的时候，可以用名称、优先级和启动类型来定义。启动类型由时间（周期时间、随机时间）或者内部或者外部的触发任务时间来定义。

  准则：

  * 循环任务、自由运行任务、事件触发任务的最大个数都是100。
  * PLC_PRG可能会在任何情况下作为一个自由程序执行，而不用插入任务配置中
  * 处理和调用程序是根据任务编辑器内自上而下的顺序所执行的

  **PLC执行的过程**，如下图所示

  ![1591926891271](C:\Users\Giggy\AppData\Roaming\Typora\typora-user-images\1591926891271.png)

  （1）输入采样

  ​	在每次扫描周期开始的时候，PLC检测输入设备的状态，将状态写入输入映像寄存区内。在程序执行时候，运行系统从输入映像区读取数据进行程序结算。输入映像区的刷新只发生在一个扫描周期的开始阶段。在扫描过程中，即使输出状态改变，输入状态也不会发生变化。

  （2）执行程序

  ​	

  （3）输出刷新

  ​	写输出阶段，PLC将输出映像区的状态和数据传送到输出点上，并通过一定的方式隔离和功率放大，驱动外部负载。

  

  ​	**PLC在一个扫描周期内，除了完成上述三个阶段的任务外，还要完成内部诊断、通信、公共处理以及输入、输出服务等辅助任务。**

  ​	**由于PLC采用循环的工作方式，输入信号只在周期起始刷新，输出信号只在周期结束输出，所以必然会产生输出信号相当于输入信号的滞后现象。**

  滞后时间是设计PLC控制系统时应该了解的一个重要参数。



* 任务的执行类型

  ​	针对每个独立的任务，可以配置其执行的类型。包括固定周期循环、时间触发、自由运行和状态触发这4种类型。

  ![1591928303375](C:\Users\Giggy\AppData\Roaming\Typora\typora-user-images\1591928303375.png)



* 系统事件

  ​	系统时间是根绝实际的目标系统而定的，由目标系统对应的库文件提供相应的系统事件。不同的目标硬件设备对应的“系统事件”可能会不同。

  ​	常用的系统事件有：停止，开始，登入，改变等。



* 任务优先级

  最多可以设置32个级别，0-31。（这个需要看纸质书的版本）



* 看门狗

  ​	可以理解为try catch功能。看门狗功能的触发事件必须大于程序的执行周期，否则将激活看门狗功能，并终止当前任务。

  ​	看门狗的触发事件=时间*灵敏度，如果程序实际执行时间超过看门狗的触发事件，则会激活看门狗。

  ​	看门狗主要应用于实时性及安全等级比较高的场合，主要是为了防止PLC死机或者防止程序进入死循环，一旦出现故障会将所有输出断开并重启PLC，这样就能够有效的 防止控制器死机和保护外围的设备。





## 库文件

​	库文件用来存在Codesys中可以多次使用的程序组织单元POU。



​	默认的函数库文件是“.library”，加密库的扩展名为“.compiled-library”，库文件可以通过一个许可证进行加密。



* 应用库文件

  * Util：包含了各种数学运算功能，位操作指令以及控制器等功能
  * Standard：包括定时器、计数器、边沿检测以及双稳态触发器等函数及功能块。

  Toolbox和PLCopen等库文件，需要根据用户的实际需求来添加。



​		**注意：库文件只要被载入就会占用用户空间，不要载入不使用的库文件。**

* 库文件的多版本问题

  ​	一个函数库的不同版本可以同时安装在一个系统上，在一个工程中可以包含相同函数库的不同版本。应用程序使用哪个版本是按照如下规定进行的：

  * 如果在相同的函数库管理中多个版本都有相同的级别，那么将根据当前的“属性”决定哪个版本将会被调用。（默认的是最新版本）
  * 如果在同一个函数库管理中一个函数库的不同版本有不同的级别，特殊访问的库文件通过添加适当的命名空间决定使用哪个

  

* 库文件的属性

  * 唯一访问性

    在“库属性”中，可以定义库的默认命名空间，如果没有明确定义，命名空间则等同于库名称。

  * 代码安全性

    可以在“工程设置”中的“安全”对其进行设置。



* 创建库文件

  注意：

  * 如果一个库被其他库引用，就应当考虑这个库由于被其他库引用而被包含进一个工程中，他的属性。
  * Codesys Container Library，容器库，本身没有任何内容，就是引用了一些其他的库。为了方便使用“容器库”，用户可以在创建它们时激活“publish”，这样可以将它们设置为“顶层库”，从而可以在使用时忽略它们的命名空间。




## 程序组织单元

* POU，Program Organization Unit。
* 按照功能分类，可分为函数（FUN）、功能块（FB）和程序（PRG）三个部分







## 应用对象

* Trace





* 持续变量
  * 持续变量，主要有两种RETAIN和PERSISTANT RETAIN，其主要作用是系统关机或者异常断电后，数据还在PLC的内部。





* 数据单元类型DUT
  * Data Unit Type：包括结构体、枚举、别名和联合等。





* 全局网络变量

  没有很具体的应用场景





* 配方管理器

  